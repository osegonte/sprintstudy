<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Planner - Smart PDF Reader & Progress Tracker</title>
    
    <!-- React & Dependencies -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    
    <style>
        :root {
            --primary: #667eea;
            --primary-dark: #5a67d8;
            --secondary: #764ba2;
            --success: #48bb78;
            --warning: #ed8936;
            --danger: #f56565;
            --info: #4299e1;
            
            --bg-primary: #f7fafc;
            --bg-secondary: #edf2f7;
            --bg-card: #ffffff;
            --text-primary: #2d3748;
            --text-secondary: #4a5568;
            --text-muted: #718096;
            --border: #e2e8f0;
            
            --shadow: 0 4px 6px rgba(0,0,0,0.07);
            --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
            --shadow-xl: 0 20px 25px rgba(0,0,0,0.15);
            
            --radius: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-full: 9999px;
            
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
            
            --transition: 0.2s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            min-height: 100vh;
            color: var(--text-primary);
            line-height: 1.6;
        }

        .app-container {
            max-width: 1440px;
            margin: 0 auto;
            min-height: 100vh;
            background: var(--bg-primary);
            box-shadow: var(--shadow-xl);
        }

        .header {
            background: var(--bg-card);
            padding: var(--spacing-lg) var(--spacing-xl);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .logo-icon {
            font-size: 2rem;
        }

        .user-controls {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-full);
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .sidebar {
            width: 280px;
            background: var(--bg-card);
            border-right: 1px solid var(--border);
            position: fixed;
            left: 0;
            top: 81px;
            bottom: 0;
            overflow-y: auto;
            padding: var(--spacing-lg);
            z-index: 50;
            transition: transform var(--transition);
        }

        .main-content {
            margin-left: 280px;
            padding: var(--spacing-xl);
            min-height: calc(100vh - 81px);
        }

        .nav {
            list-style: none;
            margin-bottom: var(--spacing-xl);
        }

        .nav-item {
            padding: var(--spacing-md) var(--spacing-lg);
            border-radius: var(--radius);
            cursor: pointer;
            transition: all var(--transition);
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            font-weight: 500;
            color: var(--text-secondary);
        }

        .nav-item:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .nav-item.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: var(--shadow);
        }

        .nav-icon {
            font-size: 1.1rem;
            width: 20px;
            text-align: center;
        }

        .btn {
            padding: var(--spacing-md) var(--spacing-lg);
            border: none;
            border-radius: var(--radius);
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition);
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-sm);
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: var(--shadow);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #68d391);
            color: white;
            box-shadow: var(--shadow);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #f6ad55);
            color: white;
        }

        .btn-ghost {
            background: transparent;
            color: var(--text-secondary);
            border: 1px solid var(--border);
        }

        .btn-ghost:hover:not(:disabled) {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-sm {
            padding: var(--spacing-sm) var(--spacing-md);
            font-size: 0.85rem;
        }

        .btn-lg {
            padding: var(--spacing-lg) var(--spacing-xl);
            font-size: 1.1rem;
        }

        .btn-xl {
            padding: var(--spacing-xl) 40px;
            font-size: 1.2rem;
            border-radius: var(--radius-lg);
        }

        .card {
            background: var(--bg-card);
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            box-shadow: var(--shadow);
            transition: all var(--transition);
            border: 1px solid transparent;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--border);
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }

        .stat-card {
            background: var(--bg-card);
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            box-shadow: var(--shadow);
            transition: all var(--transition);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            opacity: 0;
            transition: opacity var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        .stat-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: var(--spacing-sm);
            line-height: 1;
        }

        .stat-label {
            color: var(--text-muted);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 500;
        }

        .stat-icon {
            font-size: 3rem;
            opacity: 0.7;
        }

        .stat-change {
            margin-top: var(--spacing-sm);
            font-size: 0.85rem;
            font-weight: 500;
        }

        .stat-change.positive {
            color: var(--success);
        }

        .stat-change.negative {
            color: var(--danger);
        }

        .progress-ring {
            width: 80px;
            height: 80px;
            transform: rotate(-90deg);
        }

        .progress-ring-circle {
            fill: none;
            stroke-width: 8;
        }

        .progress-ring-bg {
            stroke: var(--bg-secondary);
        }

        .progress-ring-progress {
            stroke: var(--primary);
            stroke-linecap: round;
            transition: stroke-dashoffset 0.5s ease;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--bg-secondary);
            border-radius: var(--radius-full);
            overflow: hidden;
            margin: var(--spacing-md) 0;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: width 0.3s ease;
        }

        .sprint-card {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            text-align: center;
            margin-bottom: var(--spacing-lg);
            position: relative;
            overflow: hidden;
        }

        .sprint-title {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: var(--spacing-md);
        }

        .sprint-details {
            opacity: 0.9;
            margin-bottom: var(--spacing-lg);
            font-size: 1.05rem;
        }

        .topic-card {
            background: var(--bg-card);
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            box-shadow: var(--shadow);
            margin-bottom: var(--spacing-md);
            transition: all var(--transition);
            cursor: pointer;
            position: relative;
        }

        .topic-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            width: 4px;
            background: var(--primary);
            opacity: 0;
            transition: opacity var(--transition);
        }

        .topic-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .topic-card:hover::before {
            opacity: 1;
        }

        .topic-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--spacing-md);
        }

        .topic-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .topic-icon {
            font-size: 1.4rem;
        }

        .topic-meta {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-top: var(--spacing-sm);
        }

        .topic-actions {
            display: flex;
            gap: var(--spacing-sm);
        }

        .topic-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: var(--spacing-md);
            margin-top: var(--spacing-md);
            padding-top: var(--spacing-md);
            border-top: 1px solid var(--border);
        }

        .topic-stat {
            text-align: center;
        }

        .topic-stat-number {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary);
            line-height: 1;
        }

        .topic-stat-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            backdrop-filter: blur(4px);
        }

        .modal {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--border);
        }

        .modal-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-muted);
            padding: var(--spacing-sm);
            border-radius: var(--radius);
            transition: all var(--transition);
        }

        .modal-close:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: var(--spacing-md);
            padding-top: var(--spacing-md);
            border-top: 1px solid var(--border);
            margin-top: var(--spacing-lg);
        }

        .form-group {
            margin-bottom: var(--spacing-lg);
        }

        .form-label {
            display: block;
            margin-bottom: var(--spacing-sm);
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-label.required::after {
            content: '*';
            color: var(--danger);
            margin-left: 4px;
        }

        .form-control {
            width: 100%;
            padding: var(--spacing-md) var(--spacing-lg);
            border: 2px solid var(--border);
            border-radius: var(--radius);
            font-size: 1rem;
            transition: all var(--transition);
            background: var(--bg-card);
            color: var(--text-primary);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 12px center;
            background-repeat: no-repeat;
            background-size: 16px 12px;
            padding-right: 40px;
            appearance: none;
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }

        .file-upload-zone {
            border: 2px dashed var(--primary);
            border-radius: var(--radius-md);
            padding: var(--spacing-xl);
            text-align: center;
            background: rgba(102, 126, 234, 0.05);
            cursor: pointer;
            transition: all var(--transition);
        }

        .file-upload-zone:hover {
            border-color: var(--primary);
            background: rgba(102, 126, 234, 0.1);
        }

        .file-upload-zone.drag-over {
            border-color: var(--success);
            background: rgba(72, 187, 120, 0.1);
        }

        .file-upload-icon {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: var(--spacing-md);
        }

        .file-upload-text {
            font-size: 1.1rem;
            font-weight: 500;
            margin-bottom: var(--spacing-sm);
        }

        .file-upload-hint {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(102, 126, 234, 0.2);
            border-top: 3px solid var(--primary);
            border-radius: var(--radius-full);
            animation: spin 1s linear infinite;
        }

        .loading-lg {
            width: 40px;
            height: 40px;
            border-width: 4px;
        }

        .reading-tracker {
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            box-shadow: var(--shadow-xl);
            z-index: 1000;
            min-width: 260px;
            border: 1px solid var(--border);
        }

        .timer-display {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--primary);
            text-align: center;
            margin-bottom: var(--spacing-md);
            font-feature-settings: 'tnum';
        }

        .performance-feedback {
            background: var(--bg-secondary);
            border-radius: var(--radius);
            padding: var(--spacing-md);
            text-align: center;
            margin: var(--spacing-md) 0;
            font-weight: 600;
        }

        .feedback-perfect {
            background: linear-gradient(135deg, #f0fff4, #c6f6d5);
            color: var(--success);
        }

        .feedback-fast {
            background: linear-gradient(135deg, #e6fffa, #b2f5ea);
            color: #319795;
        }

        .feedback-slow {
            background: linear-gradient(135deg, #fffbeb, #fef5e7);
            color: var(--warning);
        }

        .session-stats {
            background: var(--bg-secondary);
            border-radius: var(--radius);
            padding: var(--spacing-md);
            margin-top: var(--spacing-md);
        }

        .session-stats h4 {
            margin-bottom: var(--spacing-sm);
            font-size: 0.95rem;
        }

        .session-stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .streak-counter {
            background: linear-gradient(135deg, #ff9a56, #ff6b6b);
            color: white;
            border-radius: var(--radius);
            padding: var(--spacing-md);
            text-align: center;
            margin-bottom: var(--spacing-md);
        }

        .streak-number {
            font-size: 2rem;
            font-weight: 700;
            line-height: 1;
        }

        .streak-label {
            font-size: 0.8rem;
            opacity: 0.9;
            margin-top: 4px;
        }

        .pdf-controls {
            background: var(--bg-secondary);
            padding: var(--spacing-md) var(--spacing-lg);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap;
            gap: var(--spacing-md);
        }

        .pdf-controls-group {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .pdf-canvas-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: var(--spacing-lg);
            background: #f5f5f5;
            min-height: 600px;
            overflow: auto;
        }

        .pdf-canvas {
            display: block;
            max-width: 100%;
            box-shadow: var(--shadow-lg);
            background: white;
            border-radius: 4px;
        }

        .celebration-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            box-shadow: var(--shadow-xl);
            z-index: 3000;
            text-align: center;
            min-width: 320px;
        }

        .celebration-emoji {
            font-size: 4rem;
            margin-bottom: var(--spacing-lg);
        }

        .celebration-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: var(--spacing-md);
        }

        .celebration-stats {
            background: var(--bg-secondary);
            border-radius: var(--radius);
            padding: var(--spacing-md);
            margin: var(--spacing-lg) 0;
        }

        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: var(--spacing-lg);
        }

        .achievement-card {
            background: var(--bg-card);
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            box-shadow: var(--shadow);
            text-align: center;
            transition: all var(--transition);
        }

        .achievement-card.earned {
            border: 2px solid var(--success);
            background: rgba(72, 187, 120, 0.05);
        }

        .achievement-card.locked {
            opacity: 0.6;
        }

        .achievement-icon {
            font-size: 3rem;
            margin-bottom: var(--spacing-md);
        }

        .achievement-title {
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
        }

        .achievement-description {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-bottom: var(--spacing-md);
        }

        .achievement-progress {
            background: var(--bg-secondary);
            border-radius: var(--radius-full);
            height: 6px;
            overflow: hidden;
        }

        .achievement-progress-fill {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            height: 100%;
            transition: width 0.3s ease;
        }

        .achievement-badge {
            display: inline-block;
            background: var(--success);
            color: white;
            padding: 4px 12px;
            border-radius: var(--radius-full);
            font-size: 0.8rem;
            font-weight: 600;
            margin: 4px;
        }

        .achievement-badge.uncommon {
            background: var(--warning);
        }

        .achievement-badge.rare {
            background: var(--secondary);
        }

        .achievement-badge.epic {
            background: var(--info);
        }

        .achievement-badge.legendary {
            background: linear-gradient(135deg, #d53f8c, #ed64a6);
        }

        /* Utility Classes */
        .text-center { text-align: center; }
        .text-left { text-align: left; }
        .text-right { text-align: right; }
        .d-flex { display: flex; }
        .d-grid { display: grid; }
        .d-none { display: none; }
        .d-block { display: block; }
        .justify-between { justify-content: space-between; }
        .justify-center { justify-content: center; }
        .items-center { align-items: center; }
        .gap-sm { gap: var(--spacing-sm); }
        .gap-md { gap: var(--spacing-md); }
        .gap-lg { gap: var(--spacing-lg); }
        .mb-sm { margin-bottom: var(--spacing-sm); }
        .mb-md { margin-bottom: var(--spacing-md); }
        .mb-lg { margin-bottom: var(--spacing-lg); }
        .mb-xl { margin-bottom: var(--spacing-xl); }
        .p-lg { padding: var(--spacing-lg); }
        .pulse { animation: pulse 2s infinite; }

        /* Animations */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .main-content {
                margin-left: 0;
                padding: var(--spacing-lg);
            }
            
            .sidebar {
                transform: translateX(-100%);
                z-index: 200;
            }
            
            .sidebar.mobile-open {
                transform: translateX(0);
            }
            
            .reading-tracker {
                position: static;
                transform: none;
                margin: var(--spacing-lg) 0;
                width: 100%;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: var(--spacing-md);
            }

            .main-content {
                padding: var(--spacing-md);
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .stat-number {
                font-size: 2rem;
            }

            .modal {
                width: 95%;
                padding: var(--spacing-lg);
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef, createContext, useContext } = React;

        // Configuration
        const API_BASE_URL = window.location.hostname === 'localhost' 
            ? 'http://localhost:3000' 
            : 'https://sprintstudy-production.up.railway.app';

        const ROUTES = {
            DASHBOARD: 'dashboard',
            DOCUMENTS: 'documents',
            TOPICS: 'topics',
            SPRINTS: 'sprints',
            ACHIEVEMENTS: 'achievements',
            ANALYTICS: 'analytics',
            SETTINGS: 'settings'
        };

        const ACHIEVEMENT_RARITIES = {
            common: { color: '#48bb78', label: 'Common' },
            uncommon: { color: '#ed8936', label: 'Uncommon' },
            rare: { color: '#9f7aea', label: 'Rare' },
            epic: { color: '#667eea', label: 'Epic' },
            legendary: { color: '#d53f8c', label: 'Legendary' }
        };

        // Context
        const AppContext = createContext();

        // API utilities
        const api = {
            async request(endpoint, options = {}) {
                const token = localStorage.getItem('token');
                const config = {
                    ...options,
                    headers: {
                        'Content-Type': 'application/json',
                        ...(token && { 'Authorization': `Bearer ${token}` }),
                        ...options.headers,
                    },
                };

                try {
                    const response = await axios(`${API_BASE_URL}${endpoint}`, config);
                    return { data: response.data, error: null };
                } catch (error) {
                    console.error('API Error:', error);
                    
                    if (error.response?.status === 401) {
                        localStorage.removeItem('token');
                        window.location.reload();
                    }
                    
                    return { 
                        data: null, 
                        error: error.response?.data?.error || error.message || 'Network error' 
                    };
                }
            },

            async get(endpoint) {
                return this.request(endpoint, { method: 'GET' });
            },

            async post(endpoint, data) {
                return this.request(endpoint, { method: 'POST', data });
            },

            async patch(endpoint, data) {
                return this.request(endpoint, { method: 'PATCH', data });
            },

            async delete(endpoint) {
                return this.request(endpoint, { method: 'DELETE' });
            },

            async uploadFile(endpoint, formData) {
                const token = localStorage.getItem('token');
                try {
                    const response = await axios.post(`${API_BASE_URL}${endpoint}`, formData, {
                        headers: {
                            'Content-Type': 'multipart/form-data',
                            ...(token && { 'Authorization': `Bearer ${token}` }),
                        },
                    });
                    return { data: response.data, error: null };
                } catch (error) {
                    return { 
                        data: null, 
                        error: error.response?.data?.error || error.message || 'Upload failed' 
                    };
                }
            }
        };

        // Utility functions
        const formatTime = (seconds) => {
            if (!seconds) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        };

        const formatDate = (dateString) => {
            if (!dateString) return '';
            return new Date(dateString).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        };

        const formatRelativeTime = (dateString) => {
            if (!dateString) return '';
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMins / 60);
            const diffDays = Math.floor(diffHours / 24);

            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            if (diffDays < 7) return `${diffDays}d ago`;
            return formatDate(dateString);
        };

        // Shared components
        function ProgressRing({ progress, size = 80 }) {
            const radius = (size - 8) / 2;
            const circumference = radius * 2 * Math.PI;
            const offset = circumference - (progress / 100) * circumference;

            return (
                <svg className="progress-ring" width={size} height={size}>
                    <circle
                        className="progress-ring-circle progress-ring-bg"
                        cx={size / 2}
                        cy={size / 2}
                        r={radius}
                        strokeWidth={8}
                    />
                    <circle
                        className="progress-ring-circle progress-ring-progress"
                        cx={size / 2}
                        cy={size / 2}
                        r={radius}
                        strokeWidth={8}
                        strokeDasharray={circumference}
                        strokeDashoffset={offset}
                    />
                </svg>
            );
        }

        function LoadingSpinner({ size = 'md' }) {
            return <span className={size === 'lg' ? 'loading-lg' : 'loading'}></span>;
        }

        function ErrorMessage({ error, onRetry }) {
            if (!error) return null;
            return (
                <div className="card" style={{ border: '1px solid var(--danger)', background: 'rgba(245, 101, 101, 0.05)' }}>
                    <div className="d-flex items-center gap-md">
                        <span style={{ fontSize: '1.5rem' }}>‚ö†Ô∏è</span>
                        <div style={{ flex: 1 }}>
                            <strong>Something went wrong</strong>
                            <p style={{ margin: '4px 0 0 0', color: 'var(--text-muted)' }}>{error}</p>
                        </div>
                        {onRetry && (
                            <button className="btn btn-danger btn-sm" onClick={onRetry}>
                                Try Again
                            </button>
                        )}
                    </div>
                </div>
            );
        }

        function EmptyState({ icon, title, description, action }) {
            return (
                <div className="text-center p-lg">
                    <div style={{ fontSize: '4rem', marginBottom: 'var(--spacing-lg)', opacity: 0.5 }}>
                        {icon}
                    </div>
                    <h3 style={{ marginBottom: 'var(--spacing-md)' }}>{title}</h3>
                    <p style={{ color: 'var(--text-muted)', marginBottom: 'var(--spacing-lg)' }}>
                        {description}
                    </p>
                    {action}
                </div>
            );
        }

        function Modal({ isOpen, onClose, title, children }) {
            useEffect(() => {
                if (isOpen) {
                    document.body.style.overflow = 'hidden';
                } else {
                    document.body.style.overflow = 'unset';
                }
                return () => {
                    document.body.style.overflow = 'unset';
                };
            }, [isOpen]);

            if (!isOpen) return null;

            const handleOverlayClick = (e) => {
                if (e.target === e.currentTarget) {
                    onClose();
                }
            };

            return (
                <div className="modal-overlay" onClick={handleOverlayClick}>
                    <div className="modal">
                        <div className="modal-header">
                            <h2 className="modal-title">{title}</h2>
                            <button className="modal-close" onClick={onClose}>√ó</button>
                        </div>
                        <div>
                            {children}
                        </div>
                    </div>
                </div>
            );
        }

        function Toast({ message, type = 'info', isVisible, onClose }) {
            useEffect(() => {
                if (isVisible) {
                    const timer = setTimeout(onClose, 4000);
                    return () => clearTimeout(timer);
                }
            }, [isVisible, onClose]);

            if (!isVisible) return null;

            const typeStyles = {
                success: { background: 'var(--success)', color: 'white' },
                error: { background: 'var(--danger)', color: 'white' },
                warning: { background: 'var(--warning)', color: 'white' },
                info: { background: 'var(--info)', color: 'white' }
            };

            return (
                <div 
                    style={{
                        position: 'fixed',
                        top: '20px',
                        right: '20px',
                        padding: 'var(--spacing-md) var(--spacing-lg)',
                        borderRadius: 'var(--radius)',
                        boxShadow: 'var(--shadow-lg)',
                        zIndex: 3000,
                        display: 'flex',
                        alignItems: 'center',
                        gap: 'var(--spacing-md)',
                        minWidth: '300px',
                        animation: 'slideInRight 0.3s ease',
                        ...typeStyles[type]
                    }}
                >
                    <span>{message}</span>
                    <button 
                        onClick={onClose}
                        style={{ 
                            background: 'none', 
                            border: 'none', 
                            color: 'inherit', 
                            cursor: 'pointer',
                            fontSize: '1.2rem'
                        }}
                    >
                        √ó
                    </button>
                </div>
            );
        }

        // Auth Component
        function AuthForm({ onLogin }) {
            const [isLogin, setIsLogin] = useState(true);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');
            const [formData, setFormData] = useState({
                email: '',
                password: '',
                username: ''
            });

            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);
                setError('');

                const endpoint = isLogin ? '/api/auth/login' : '/api/auth/signup';
                const { data, error } = await api.post(endpoint, formData);

                if (error) {
                    setError(error);
                } else {
                    localStorage.setItem('token', data.session.access_token);
                    onLogin(data.user);
                }

                setLoading(false);
            };

            const handleInputChange = (e) => {
                setFormData({
                    ...formData,
                    [e.target.name]: e.target.value
                });
            };

            return (
                <div className="modal-overlay">
                    <div className="modal" style={{ maxWidth: '400px' }}>
                        <div className="text-center mb-lg">
                            <div className="logo" style={{ justifyContent: 'center', fontSize: '2rem', marginBottom: 'var(--spacing-md)' }}>
                                <span className="logo-icon">üìö</span>
                                Study Planner
                            </div>
                            <h2>{isLogin ? 'üîê Welcome Back' : 'üìö Join Study Planner'}</h2>
                            <p style={{ color: 'var(--text-muted)', marginTop: 'var(--spacing-sm)' }}>
                                {isLogin ? 'Sign in to continue your learning journey' : 'Start tracking your reading progress today'}
                            </p>
                        </div>

                        {error && (
                            <div style={{ 
                                background: 'rgba(245, 101, 101, 0.1)', 
                                border: '1px solid var(--danger)', 
                                borderRadius: 'var(--radius)', 
                                padding: 'var(--spacing-md)', 
                                marginBottom: 'var(--spacing-lg)',
                                color: 'var(--danger)'
                            }}>
                                ‚ö†Ô∏è {error}
                            </div>
                        )}

                        <form onSubmit={handleSubmit}>
                            <div className="form-group">
                                <label className="form-label required">Email</label>
                                <input
                                    type="email"
                                    name="email"
                                    className="form-control"
                                    value={formData.email}
                                    onChange={handleInputChange}
                                    placeholder="Enter your email"
                                    required
                                />
                            </div>

                            <div className="form-group">
                                <label className="form-label required">Password</label>
                                <input
                                    type="password"
                                    name="password"
                                    className="form-control"
                                    value={formData.password}
                                    onChange={handleInputChange}
                                    placeholder="Enter your password"
                                    required
                                />
                            </div>

                            {!isLogin && (
                                <div className="form-group">
                                    <label className="form-label">Username (optional)</label>
                                    <input
                                        type="text"
                                        name="username"
                                        className="form-control"
                                        value={formData.username}
                                        onChange={handleInputChange}
                                        placeholder="Choose a username"
                                    />
                                </div>
                            )}

                            <button 
                                type="submit" 
                                className="btn btn-primary btn-lg" 
                                disabled={loading} 
                                style={{ width: '100%', marginBottom: 'var(--spacing-md)' }}
                            >
                                {loading && <LoadingSpinner />}
                                {isLogin ? 'Sign In' : 'Create Account'}
                            </button>
                        </form>

                        <div className="text-center">
                            <button 
                                className="btn btn-ghost" 
                                onClick={() => setIsLogin(!isLogin)}
                                style={{ width: '100%' }}
                            >
                                {isLogin ? 'Need an account? Sign Up' : 'Have an account? Sign In'}
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // Dashboard Component
        function Dashboard({ user }) {
            const [dashboardData, setDashboardData] = useState(null);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState('');

            useEffect(() => {
                loadDashboard();
            }, []);

            const loadDashboard = async () => {
                setLoading(true);
                setError('');

                try {
                    const { data: dashData, error: dashError } = await api.get('/api/analytics/dashboard');
                    if (dashError) throw new Error(dashError);
                    setDashboardData(dashData);
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            if (loading) {
                return (
                    <div className="text-center" style={{ padding: '60px' }}>
                        <LoadingSpinner size="lg" />
                        <p style={{ marginTop: 'var(--spacing-lg)', color: 'var(--text-muted)' }}>
                            Loading your dashboard...
                        </p>
                    </div>
                );
            }

            if (error) {
                return <ErrorMessage error={error} onRetry={loadDashboard} />;
            }

            const overview = dashboardData?.overview || {};

            return (
                <div>
                    <div style={{ marginBottom: 'var(--spacing-xl)' }}>
                        <h1 style={{ marginBottom: 'var(--spacing-sm)' }}>
                            Welcome back, {user.email?.split('@')[0] || 'Student'}! üëã
                        </h1>
                        <p style={{ color: 'var(--text-muted)' }}>
                            Here's your learning progress and today's recommendations
                        </p>
                    </div>

                    <div className="dashboard-grid">
                        <div className="stat-card">
                            <div className="stat-content">
                                <div className="stat-info">
                                    <div className="stat-number">{overview.total_documents || 0}</div>
                                    <div className="stat-label">Total PDFs</div>
                                    <div className="stat-change positive">
                                        +{Math.floor(Math.random() * 3)} this week
                                    </div>
                                </div>
                                <div className="stat-icon">üìö</div>
                            </div>
                        </div>

                        <div className="stat-card">
                            <div className="stat-content">
                                <div className="stat-info">
                                    <div className="stat-number">{overview.completion_percentage || 0}%</div>
                                    <div className="stat-label">Overall Progress</div>
                                    <div className="stat-change positive">
                                        +{Math.floor(Math.random() * 10)}% this week
                                    </div>
                                </div>
                                <ProgressRing progress={overview.completion_percentage || 0} />
                            </div>
                        </div>

                        <div className="stat-card">
                            <div className="stat-content">
                                <div className="stat-info">
                                    <div className="stat-number">{Math.round((overview.total_time_spent_seconds || 0) / 60)}</div>
                                    <div className="stat-label">Minutes Read</div>
                                    <div className="stat-change positive">
                                        +{Math.floor(Math.random() * 120)} this week
                                    </div>
                                </div>
                                <div className="stat-icon">‚è±Ô∏è</div>
                            </div>
                        </div>

                        <div className="stat-card">
                            <div className="stat-content">
                                <div className="stat-info">
                                    <div className="stat-number">{Math.round((overview.average_reading_speed_seconds || 0) / 60)}</div>
                                    <div className="stat-label">Min/Page Avg</div>
                                    <div className="stat-change negative">
                                        -{Math.floor(Math.random() * 30)}s this week
                                    </div>
                                </div>
                                <div className="stat-icon">üìä</div>
                            </div>
                        </div>
                    </div>

                    {overview.total_documents === 0 && (
                        <div className="card text-center">
                            <div style={{ padding: '60px' }}>
                                <div style={{ fontSize: '4rem', marginBottom: 'var(--spacing-lg)' }}>üöÄ</div>
                                <h3 style={{ marginBottom: 'var(--spacing-md)' }}>Ready to start studying?</h3>
                                <p style={{ color: 'var(--text-muted)', marginBottom: 'var(--spacing-lg)' }}>
                                    Upload your first PDF document to begin tracking your reading progress.
                                </p>
                                <button 
                                    className="btn btn-primary btn-lg"
                                    onClick={() => window.dispatchEvent(new CustomEvent('navigate', { detail: ROUTES.DOCUMENTS }))}
                                >
                                    üì§ Upload Your First PDF
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // Documents Component
        function Documents({ onOpenReader }) {
            const [documents, setDocuments] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState('');
            const [showUpload, setShowUpload] = useState(false);

            useEffect(() => {
                loadDocuments();
            }, []);

            const loadDocuments = async () => {
                setLoading(true);
                setError('');
                
                const { data, error } = await api.get('/api/documents');
                
                if (error) {
                    setError(error);
                } else {
                    setDocuments(data.documents || []);
                }
                
                setLoading(false);
            };

            const handleRead = (doc) => {
                onOpenReader(doc);
            };

            if (loading) {
                return (
                    <div className="text-center" style={{ padding: '60px' }}>
                        <LoadingSpinner size="lg" />
                        <p style={{ marginTop: 'var(--spacing-lg)', color: 'var(--text-muted)' }}>
                            Loading your documents...
                        </p>
                    </div>
                );
            }

            if (error) {
                return <ErrorMessage error={error} onRetry={loadDocuments} />;
            }

            return (
                <div>
                    <div className="d-flex justify-between items-center mb-xl">
                        <div>
                            <h1 style={{ marginBottom: 'var(--spacing-sm)' }}>
                                üìö My Documents ({documents.length})
                            </h1>
                            <p style={{ color: 'var(--text-muted)' }}>
                                Manage your PDF documents and track reading progress
                            </p>
                        </div>
                        <button className="btn btn-primary" onClick={() => setShowUpload(true)}>
                            üì§ Upload PDF
                        </button>
                    </div>

                    {documents.length === 0 ? (
                        <EmptyState
                            icon="üìÑ"
                            title="No documents yet"
                            description="Upload your first PDF to start tracking your reading progress with intelligent features."
                            action={
                                <button className="btn btn-primary btn-lg" onClick={() => setShowUpload(true)}>
                                    üì§ Upload Your First PDF
                                </button>
                            }
                        />
                    ) : (
                        <div style={{ display: 'grid', gap: 'var(--spacing-lg)' }}>
                            {documents.map(doc => (
                                <div key={doc.id} className="topic-card">
                                    <div className="topic-header">
                                        <div>
                                            <div className="topic-title">
                                                üìÑ {doc.title}
                                            </div>
                                            <div className="topic-meta">
                                                {doc.total_pages} pages ‚Ä¢ Uploaded {formatDate(doc.created_at)}
                                            </div>
                                        </div>
                                        <button 
                                            className="btn btn-primary" 
                                            onClick={() => handleRead(doc)}
                                        >
                                            üìñ Read
                                        </button>
                                    </div>
                                    
                                    <div className="progress-bar">
                                        <div 
                                            className="progress-bar-fill" 
                                            style={{ width: `${doc.completion_percentage}%` }}
                                        ></div>
                                    </div>
                                    
                                    <div className="topic-stats">
                                        <div className="topic-stat">
                                            <div className="topic-stat-number">{doc.completion_percentage}%</div>
                                            <div className="topic-stat-label">Complete</div>
                                        </div>
                                        <div className="topic-stat">
                                            <div className="topic-stat-number">{doc.completed_pages}</div>
                                            <div className="topic-stat-label">Pages Read</div>
                                        </div>
                                        <div className="topic-stat">
                                            <div className="topic-stat-number">{Math.round(doc.total_time_spent_seconds / 60)}</div>
                                            <div className="topic-stat-label">Minutes</div>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}

                    {showUpload && (
                        <UploadModal 
                            onClose={() => setShowUpload(false)} 
                            onSuccess={() => {
                                setShowUpload(false);
                                loadDocuments();
                            }} 
                        />
                    )}
                </div>
            );
        }

        function UploadModal({ onClose, onSuccess }) {
            const [uploading, setUploading] = useState(false);
            const [dragOver, setDragOver] = useState(false);
            const [uploadProgress, setUploadProgress] = useState(0);
            const [error, setError] = useState('');

            const handleFileUpload = async (file) => {
                if (!file || file.type !== 'application/pdf') {
                    setError('Please select a PDF file');
                    return;
                }

                setUploading(true);
                setError('');
                setUploadProgress(0);

                const formData = new FormData();
                formData.append('pdf', file);
                formData.append('title', file.name.replace('.pdf', ''));

                const progressInterval = setInterval(() => {
                    setUploadProgress(prev => Math.min(prev + 10, 90));
                }, 200);

                const { data, error } = await api.uploadFile('/api/documents/upload', formData);

                clearInterval(progressInterval);
                setUploadProgress(100);

                if (error) {
                    setError(error);
                    setUploading(false);
                    setUploadProgress(0);
                } else {
                    setTimeout(onSuccess, 500);
                }
            };

            const handleDrop = (e) => {
                e.preventDefault();
                setDragOver(false);
                const file = e.dataTransfer.files[0];
                handleFileUpload(file);
            };

            const handleFileSelect = (e) => {
                const file = e.target.files[0];
                handleFileUpload(file);
            };

            return (
                <Modal isOpen={true} onClose={onClose} title="üì§ Upload PDF Document">
                    {error && (
                        <div style={{ 
                            background: 'rgba(245, 101, 101, 0.1)', 
                            border: '1px solid var(--danger)', 
                            borderRadius: 'var(--radius)', 
                            padding: 'var(--spacing-md)', 
                            marginBottom: 'var(--spacing-lg)',
                            color: 'var(--danger)'
                        }}>
                            ‚ö†Ô∏è {error}
                        </div>
                    )}

                    <div 
                        className={`file-upload-zone ${dragOver ? 'drag-over' : ''}`}
                        onDrop={handleDrop}
                        onDragOver={(e) => { e.preventDefault(); setDragOver(true); }}
                        onDragLeave={() => setDragOver(false)}
                        onClick={() => !uploading && document.getElementById('file-input').click()}
                    >
                        {uploading ? (
                            <div>
                                <LoadingSpinner size="lg" />
                                <p style={{ marginTop: 'var(--spacing-md)' }}>
                                    Uploading PDF... {uploadProgress}%
                                </p>
                                <div className="progress-bar" style={{ margin: 'var(--spacing-md) auto', width: '200px' }}>
                                    <div 
                                        className="progress-bar-fill" 
                                        style={{ width: `${uploadProgress}%` }}
                                    ></div>
                                </div>
                            </div>
                        ) : (
                            <div>
                                <div className="file-upload-icon">üìÅ</div>
                                <div className="file-upload-text">
                                    Drop PDF file here or click to browse
                                </div>
                                <div className="file-upload-hint">
                                    Max file size: 50MB ‚Ä¢ Supported format: PDF
                                </div>
                            </div>
                        )}
                    </div>

                    <input
                        id="file-input"
                        type="file"
                        accept=".pdf"
                        onChange={handleFileSelect}
                        style={{ display: 'none' }}
                        disabled={uploading}
                    />

                    <div className="modal-footer">
                        <button className="btn btn-ghost" onClick={onClose} disabled={uploading}>
                            Cancel
                        </button>
                    </div>
                </Modal>
            );
        }

        // PDF Reader Component
        function PDFReader({ document, onClose }) {
            const [currentPage, setCurrentPage] = useState(1);
            const [isTracking, setIsTracking] = useState(false);
            const [startTime, setStartTime] = useState(null);
            const [timeSpent, setTimeSpent] = useState(0);
            const [performance, setPerformance] = useState(null);
            const [showCelebration, setShowCelebration] = useState(false);
            const [sessionId, setSessionId] = useState(null);
            const canvasRef = useRef(null);

            useEffect(() => {
                renderPlaceholderPage();
            }, [document, currentPage]);

            useEffect(() => {
                let interval;
                if (isTracking && startTime) {
                    interval = setInterval(() => {
                        const currentTime = Math.floor((Date.now() - startTime) / 1000);
                        setTimeSpent(currentTime);
                        updatePerformance(currentTime);
                    }, 1000);
                }
                return () => clearInterval(interval);
            }, [isTracking, startTime]);

            const renderPlaceholderPage = () => {
                const canvas = canvasRef.current;
                if (!canvas) return;

                const ctx = canvas.getContext('2d');
                canvas.width = 600;
                canvas.height = 800;

                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                ctx.strokeStyle = '#ddd';
                ctx.lineWidth = 2;
                ctx.strokeRect(20, 20, canvas.width - 40, canvas.height - 40);

                ctx.fillStyle = '#333';
                ctx.font = 'bold 24px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(document.title, canvas.width / 2, 80);

                ctx.font = '18px Arial';
                ctx.fillText(`Page ${currentPage} of ${document.total_pages}`, canvas.width / 2, 120);

                ctx.font = '16px Arial';
                ctx.textAlign = 'left';
                const lines = [
                    'This is a placeholder for the PDF content.',
                    'In the production version, the actual PDF',
                    'would be rendered here using PDF.js.',
                    '',
                    'You can still test the reading tracker',
                    'and timing features by clicking "Start Reading"',
                    'and navigating between pages.',
                    '',
                    'The app will track your reading time',
                    'and provide real-time feedback on',
                    'your reading pace compared to your',
                    'personal average.',
                    '',
                    'üéØ Features being tracked:',
                    '‚Ä¢ Reading speed per page',
                    '‚Ä¢ Focus and activity levels',
                    '‚Ä¢ Progress towards goals',
                    '‚Ä¢ Achievement milestones'
                ];

                lines.forEach((line, index) => {
                    ctx.fillText(line, 50, 180 + (index * 25));
                });
            };

            const updatePerformance = async (currentTime) => {
                // Simulate performance feedback
                const avgTime = 120; // 2 minutes average per page
                const difference = currentTime - avgTime;
                
                if (Math.abs(difference) < 15) {
                    setPerformance({ type: 'perfect', message: 'üéØ Perfect Pace!', difference: 0 });
                } else if (difference < -30) {
                    setPerformance({ type: 'fast', message: '‚ö° Fast Today!', difference });
                } else if (difference > 60) {
                    setPerformance({ type: 'slow', message: 'üê¢ Take Your Time', difference });
                } else {
                    setPerformance(null);
                }
            };

            const startReading = async () => {
                const { data, error } = await api.post('/api/sessions/start', {
                    document_id: document.id,
                    starting_page: currentPage,
                    energy_level: 4,
                    session_type: 'reading'
                });

                if (!error && data.session) {
                    setSessionId(data.session.id);
                    setIsTracking(true);
                    setStartTime(Date.now());
                    setTimeSpent(0);
                    setPerformance(null);
                }
            };

            const stopReading = async () => {
                if (!isTracking) return;

                setIsTracking(false);
                
                await api.post('/api/progress/page', {
                    document_id: document.id,
                    page_number: currentPage,
                    time_spent_seconds: timeSpent
                });

                if (sessionId) {
                    await api.patch(`/api/sessions/${sessionId}/end`, {
                        ending_page: currentPage,
                        pages_covered: Math.max(1, currentPage),
                        completion_status: 'completed'
                    });
                }

                setShowCelebration(true);
                setTimeout(() => setShowCelebration(false), 3000);
                setSessionId(null);
            };

            const nextPage = () => {
                if (currentPage < document.total_pages) {
                    setCurrentPage(prev => prev + 1);
                    if (isTracking) {
                        setStartTime(Date.now());
                        setTimeSpent(0);
                    }
                }
            };

            const prevPage = () => {
                if (currentPage > 1) {
                    setCurrentPage(prev => prev - 1);
                    if (isTracking) {
                        setStartTime(Date.now());
                        setTimeSpent(0);
                    }
                }
            };

            return (
                <div className="app-container" style={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, zIndex: 1000 }}>
                    <div className="header">
                        <div className="logo">
                            üìñ {document.title}
                        </div>
                        <div className="user-controls">
                            <span style={{ color: 'var(--text-secondary)' }}>
                                Page {currentPage} of {document.total_pages}
                            </span>
                            <button className="btn btn-ghost" onClick={onClose}>
                                ‚Üê Back to Documents
                            </button>
                        </div>
                    </div>

                    <div style={{ display: 'flex', height: 'calc(100vh - 81px)' }}>
                        <div style={{ flex: 1, display: 'flex', flexDirection: 'column' }}>
                            <div className="pdf-controls">
                                <div className="pdf-controls-group">
                                    <button 
                                        className="btn btn-ghost" 
                                        onClick={prevPage} 
                                        disabled={currentPage === 1}
                                    >
                                        ‚Üê Previous
                                    </button>
                                    <span>Page {currentPage} of {document.total_pages}</span>
                                    <button 
                                        className="btn btn-ghost" 
                                        onClick={nextPage} 
                                        disabled={currentPage === document.total_pages}
                                    >
                                        Next ‚Üí
                                    </button>
                                </div>
                                
                                <div className="pdf-controls-group">
                                    <button 
                                        className={`btn ${isTracking ? 'btn-warning' : 'btn-success'}`}
                                        onClick={isTracking ? stopReading : startReading}
                                    >
                                        {isTracking ? '‚è∏Ô∏è Stop Reading' : '‚ñ∂Ô∏è Start Reading'}
                                    </button>
                                </div>
                            </div>

                            <div className="pdf-canvas-container">
                                <canvas 
                                    ref={canvasRef}
                                    className="pdf-canvas"
                                />
                            </div>
                        </div>

                        <div className="reading-tracker">
                            <h3 style={{ textAlign: 'center', marginBottom: 'var(--spacing-md)' }}>üìä Reading Tracker</h3>
                            
                            <div className="timer-display">
                                {formatTime(timeSpent)}
                            </div>

                            <div style={{ textAlign: 'center', marginBottom: 'var(--spacing-md)' }}>
                                {isTracking ? (
                                    <span style={{ color: 'var(--success)', fontWeight: 'bold' }}>
                                        ‚è≥ Tracking...
                                    </span>
                                ) : (
                                    <span style={{ color: 'var(--text-muted)' }}>
                                        ‚è∏Ô∏è Not tracking
                                    </span>
                                )}
                            </div>

                            {performance && (
                                <div className={`performance-feedback feedback-${performance.type}`}>
                                    {performance.message}
                                    {performance.difference !== 0 && (
                                        <div style={{ fontSize: '0.8rem', marginTop: '4px' }}>
                                            {performance.difference > 0 ? '+' : ''}{performance.difference}s vs avg
                                        </div>
                                    )}
                                </div>
                            )}

                            <div className="session-stats">
                                <h4>üìà Session Stats</h4>
                                <div className="session-stat-item">
                                    <span>Current Page:</span>
                                    <span>{currentPage}</span>
                                </div>
                                <div className="session-stat-item">
                                    <span>Time This Page:</span>
                                    <span>{formatTime(timeSpent)}</span>
                                </div>
                                <div className="session-stat-item">
                                    <span>Progress:</span>
                                    <span>{Math.round((currentPage / document.total_pages) * 100)}%</span>
                                </div>
                            </div>

                            <div className="streak-counter">
                                <div style={{ fontSize: '1.2rem', fontWeight: 'bold' }}>üî• Daily Streak</div>
                                <div className="streak-number">3</div>
                                <div className="streak-label">Keep it up!</div>
                            </div>
                        </div>
                    </div>

                    {showCelebration && (
                        <div className="celebration-popup">
                            <div className="celebration-emoji">üéâ</div>
                            <h3 className="celebration-title">Great Progress!</h3>
                            <p>You've logged {formatTime(timeSpent)} on this page</p>
                            <div className="celebration-stats">
                                <div>üìñ +1 Page Completed</div>
                                <div>‚≠ê +10 XP Earned</div>
                            </div>
                            <button 
                                className="btn btn-primary" 
                                onClick={() => setShowCelebration(false)}
                            >
                                Continue Reading
                            </button>
                        </div>
                    )}
                </div>
            );
        }

        // Other Components (Simplified for space)
        function Topics() {
            return (
                <div>
                    <h1 className="mb-xl">üìÇ Study Topics</h1>
                    <EmptyState
                        icon="üöß"
                        title="Topics Coming Soon!"
                        description="Organize your PDFs by topic and set exam goals."
                        action={<button className="btn btn-primary btn-lg" disabled>üîú Available Soon</button>}
                    />
                </div>
            );
        }

        function Sprints() {
            return (
                <div>
                    <h1 className="mb-xl">üéØ Study Sprints</h1>
                    <EmptyState
                        icon="üöß"
                        title="Sprint Management Coming Soon!"
                        description="Create focused study sessions with intelligent recommendations."
                        action={<button className="btn btn-primary btn-lg" disabled>üîú Available Soon</button>}
                    />
                </div>
            );
        }

        function Achievements() {
            const [achievements, setAchievements] = useState({});
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                // Simulate loading achievements
                setTimeout(() => {
                    setAchievements({
                        progress: [
                            { id: 1, title: 'First Steps', description: 'Upload your first PDF', icon: 'üìö', is_earned: true, points: 50 },
                            { id: 2, title: 'Page Turner', description: 'Read 10 pages', icon: 'üìñ', is_earned: false, progress_percentage: 60, current_progress: 6, requirement_value: 10, points: 100 }
                        ]
                    });
                    setLoading(false);
                }, 1000);
            }, []);

            if (loading) {
                return (
                    <div className="text-center" style={{ padding: '60px' }}>
                        <LoadingSpinner size="lg" />
                        <p style={{ marginTop: 'var(--spacing-lg)' }}>Loading achievements...</p>
                    </div>
                );
            }

            return (
                <div>
                    <h1 className="mb-xl">üèÜ Achievements</h1>
                    
                    <div className="dashboard-grid mb-xl">
                        <div className="stat-card">
                            <div className="stat-content">
                                <div className="stat-info">
                                    <div className="stat-number">1</div>
                                    <div className="stat-label">Earned</div>
                                </div>
                                <div className="stat-icon">üèÜ</div>
                            </div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-content">
                                <div className="stat-info">
                                    <div className="stat-number">50</div>
                                    <div className="stat-label">Total XP</div>
                                </div>
                                <div className="stat-icon">‚≠ê</div>
                            </div>
                        </div>
                    </div>

                    {Object.keys(achievements).map(category => (
                        <div key={category} className="card mb-lg">
                            <div className="card-header">
                                <h3 className="card-title">
                                    {category.charAt(0).toUpperCase() + category.slice(1)} Achievements
                                </h3>
                            </div>
                            <div className="achievement-grid">
                                {achievements[category].map(achievement => (
                                    <div key={achievement.id} className={`achievement-card ${achievement.is_earned ? 'earned' : ''}`}>
                                        <div className="achievement-icon">{achievement.icon}</div>
                                        <h4 className="achievement-title">{achievement.title}</h4>
                                        <p className="achievement-description">{achievement.description}</p>
                                        
                                        {!achievement.is_earned && (
                                            <div>
                                                <div className="achievement-progress">
                                                    <div 
                                                        className="achievement-progress-fill" 
                                                        style={{ width: `${achievement.progress_percentage}%` }}
                                                    ></div>
                                                </div>
                                                <div style={{ marginTop: '8px', fontSize: '0.8rem', color: 'var(--text-muted)' }}>
                                                    {achievement.current_progress}/{achievement.requirement_value} 
                                                    ({achievement.progress_percentage}%)
                                                </div>
                                            </div>
                                        )}
                                        
                                        <div className="achievement-badge" style={{ marginTop: 'var(--spacing-md)' }}>
                                            {achievement.points} XP
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    ))}
                </div>
            );
        }

        function Analytics() {
            return (
                <div>
                    <h1 className="mb-xl">üìä Analytics</h1>
                    <EmptyState
                        icon="üöß"
                        title="Analytics Coming Soon!"
                        description="Detailed insights into your reading patterns and performance."
                        action={<button className="btn btn-primary btn-lg" disabled>üîú Available Soon</button>}
                    />
                </div>
            );
        }

        function Settings() {
            return (
                <div>
                    <h1 className="mb-xl">‚öôÔ∏è Settings</h1>
                    <EmptyState
                        icon="üöß"
                        title="Settings Panel Coming Soon!"
                        description="Customize your study preferences and account details."
                        action={<button className="btn btn-primary btn-lg" disabled>üîú Available Soon</button>}
                    />
                </div>
            );
        }

        // Main App Component
        function App() {
            const [user, setUser] = useState(null);
            const [currentView, setCurrentView] = useState(ROUTES.DASHBOARD);
            const [readerDocument, setReaderDocument] = useState(null);
            const [loading, setLoading] = useState(true);
            const [sidebarOpen, setSidebarOpen] = useState(false);
            const [toast, setToast] = useState({ message: '', type: 'info', isVisible: false });

            useEffect(() => {
                checkAuth();
                
                const handleNavigation = (e) => {
                    setCurrentView(e.detail);
                    setSidebarOpen(false);
                };
                
                window.addEventListener('navigate', handleNavigation);
                return () => window.removeEventListener('navigate', handleNavigation);
            }, []);

            const checkAuth = async () => {
                const token = localStorage.getItem('token');
                if (token) {
                    const { data, error } = await api.get('/api/auth/me');
                    if (!error && data.user) {
                        setUser(data.user);
                        showToast('Welcome back to Study Planner! üìö', 'success');
                    } else {
                        localStorage.removeItem('token');
                    }
                }
                setLoading(false);
            };

            const handleLogin = (userData) => {
                setUser(userData);
                showToast('Login successful! Ready to start studying? üöÄ', 'success');
            };

            const handleLogout = async () => {
                await api.post('/api/auth/logout');
                localStorage.removeItem('token');
                setUser(null);
                setCurrentView(ROUTES.DASHBOARD);
                showToast('Logged out successfully. See you soon! üëã', 'info');
            };

            const openReader = (document) => {
                setReaderDocument(document);
            };

            const closeReader = () => {
                setReaderDocument(null);
            };

            const showToast = (message, type = 'info') => {
                setToast({ message, type, isVisible: true });
            };

            const hideToast = () => {
                setToast(prev => ({ ...prev, isVisible: false }));
            };

            if (loading) {
                return (
                    <div style={{
                        display: 'flex',
                        justifyContent: 'center',
                        alignItems: 'center',
                        height: '100vh',
                        flexDirection: 'column',
                        background: 'linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%)'
                    }}>
                        <div className="logo" style={{ color: 'white', fontSize: '3rem', marginBottom: 'var(--spacing-xl)' }}>
                            <span className="logo-icon">üìö</span>
                            Study Planner
                        </div>
                        <LoadingSpinner size="lg" />
                        <p style={{ marginTop: 'var(--spacing-lg)', color: 'white', opacity: 0.9 }}>
                            Loading your study environment...
                        </p>
                    </div>
                );
            }

            if (!user) {
                return <AuthForm onLogin={handleLogin} />;
            }

            if (readerDocument) {
                return <PDFReader document={readerDocument} onClose={closeReader} />;
            }

            const renderCurrentView = () => {
                switch (currentView) {
                    case ROUTES.DASHBOARD:
                        return <Dashboard user={user} />;
                    case ROUTES.DOCUMENTS:
                        return <Documents onOpenReader={openReader} />;
                    case ROUTES.TOPICS:
                        return <Topics />;
                    case ROUTES.SPRINTS:
                        return <Sprints />;
                    case ROUTES.ACHIEVEMENTS:
                        return <Achievements />;
                    case ROUTES.ANALYTICS:
                        return <Analytics />;
                    case ROUTES.SETTINGS:
                        return <Settings />;
                    default:
                        return <Dashboard user={user} />;
                }
            };

            return (
                <AppContext.Provider value={{ user, showToast }}>
                    <div className="app-container">
                        <div className="header">
                            <div className="d-flex items-center gap-md">
                                <button 
                                    className="btn btn-ghost d-block"
                                    onClick={() => setSidebarOpen(!sidebarOpen)}
                                    style={{ display: window.innerWidth <= 1024 ? 'block' : 'none' }}
                                >
                                    ‚ò∞
                                </button>
                                <div className="logo">
                                    <span className="logo-icon">üìö</span>
                                    Study Planner
                                </div>
                            </div>
                            <div className="user-controls">
                                <div className="user-avatar">
                                    {user.email?.charAt(0).toUpperCase()}
                                </div>
                                <span style={{ color: 'var(--text-secondary)' }}>
                                    {user.username || user.email?.split('@')[0]}
                                </span>
                                <button className="btn btn-ghost" onClick={handleLogout}>
                                    Logout
                                </button>
                            </div>
                        </div>

                        <div className={`sidebar ${sidebarOpen ? 'mobile-open' : ''}`}>
                            <ul className="nav">
                                <li 
                                    className={`nav-item ${currentView === ROUTES.DASHBOARD ? 'active' : ''}`}
                                    onClick={() => setCurrentView(ROUTES.DASHBOARD)}
                                >
                                    <span className="nav-icon">üìä</span>
                                    Dashboard
                                </li>
                                <li 
                                    className={`nav-item ${currentView === ROUTES.DOCUMENTS ? 'active' : ''}`}
                                    onClick={() => setCurrentView(ROUTES.DOCUMENTS)}
                                >
                                    <span className="nav-icon">üìö</span>
                                    Documents
                                </li>
                                <li 
                                    className={`nav-item ${currentView === ROUTES.TOPICS ? 'active' : ''}`}
                                    onClick={() => setCurrentView(ROUTES.TOPICS)}
                                >
                                    <span className="nav-icon">üìÇ</span>
                                    Topics
                                </li>
                                <li 
                                    className={`nav-item ${currentView === ROUTES.SPRINTS ? 'active' : ''}`}
                                    onClick={() => setCurrentView(ROUTES.SPRINTS)}
                                >
                                    <span className="nav-icon">üéØ</span>
                                    Sprints
                                </li>
                                <li 
                                    className={`nav-item ${currentView === ROUTES.ACHIEVEMENTS ? 'active' : ''}`}
                                    onClick={() => setCurrentView(ROUTES.ACHIEVEMENTS)}
                                >
                                    <span className="nav-icon">üèÜ</span>
                                    Achievements
                                </li>
                                <li 
                                    className={`nav-item ${currentView === ROUTES.ANALYTICS ? 'active' : ''}`}
                                    onClick={() => setCurrentView(ROUTES.ANALYTICS)}
                                >
                                    <span className="nav-icon">üìä</span>
                                    Analytics
                                </li>
                                <li 
                                    className={`nav-item ${currentView === ROUTES.SETTINGS ? 'active' : ''}`}
                                    onClick={() => setCurrentView(ROUTES.SETTINGS)}
                                >
                                    <span className="nav-icon">‚öôÔ∏è</span>
                                    Settings
                                </li>
                            </ul>

                            <div style={{ 
                                background: 'var(--bg-secondary)', 
                                borderRadius: 'var(--radius)',
                                padding: 'var(--spacing-md)',
                                marginTop: 'auto'
                            }}>
                                <h4 style={{ marginBottom: 'var(--spacing-sm)', fontSize: '0.9rem' }}>üèÜ Quick Stats</h4>
                                <div style={{ fontSize: '0.8rem', color: 'var(--text-muted)' }}>
                                    <div className="d-flex justify-between mb-sm">
                                        <span>Level:</span>
                                        <span style={{ color: 'var(--primary)', fontWeight: '600' }}>3</span>
                                    </div>
                                    <div className="d-flex justify-between mb-sm">
                                        <span>Streak:</span>
                                        <span style={{ color: 'var(--success)', fontWeight: '600' }}>5 days üî•</span>
                                    </div>
                                    <div className="d-flex justify-between mb-sm">
                                        <span>XP:</span>
                                        <span style={{ color: 'var(--warning)', fontWeight: '600' }}>750</span>
                                    </div>
                                    <div className="d-flex justify-between">
                                        <span>Achievements:</span>
                                        <span style={{ color: 'var(--info)', fontWeight: '600' }}>3/19</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="main-content">
                            {renderCurrentView()}
                        </div>

                        <Toast 
                            message={toast.message}
                            type={toast.type}
                            isVisible={toast.isVisible}
                            onClose={hideToast}
                        />

                        {sidebarOpen && (
                            <div 
                                style={{
                                    position: 'fixed',
                                    top: 0,
                                    left: 0,
                                    right: 0,
                                    bottom: 0,
                                    background: 'rgba(0,0,0,0.5)',
                                    zIndex: 150
                                }}
                                onClick={() => setSidebarOpen(false)}
                            />
                        )}
                    </div>
                </AppContext.Provider>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>